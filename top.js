"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function growOuterSquare(e,t,n){deleteAllPath();var l=e,o=t||80,i=[3*o,3*o];setZoomInputListener(i);var r=n||.5;initVerticesRangeInput(l),initReducingLevelRangeInput(r);var u=[],s=PreviousPolygon.verticesAngle(l),a=s/2;u=calculateRegularPolygonsPoints(l,a,o,i),createPolygon(u);var c=new PreviousPolygon(l,u,a,o,i),v=[c];d3.select("button#inner-grow-button").on("click",function(){u=calculateNextInnerPoints(u),createPolygon(u)}),d3.select("button#outer-grow-button").on("click",function(){var e=Number(d3.selectAll("input#reducing-level")[0][0].value);o*=e,l%2===1&&(a+=180),v=createOuterRegularPolygons(v,l,a,o,e)}),d3.select("button#init-button").on("click",function(){c=createInitialPolygon(c),l=c.vertices,a=c.firstAngle,o=c.r,i=c.centerPoint,v=[c]})}function createInitialPolygon(e){deleteAllPath();var t=d3.selectAll("input#vertices")[0][0].value,n=PreviousPolygon.verticesAngle(t)/2,l=e.r,o=e.centerPoint,i=calculateRegularPolygonsPoints(t,n,l,o);return createPolygon(i),new PreviousPolygon(t,i,n,l,o)}function createOuterRegularPolygons(e,t,n,l,o){for(var i=e.slice(0),r=[],u=0;u<i.length;++u)for(var s=0;t>s;++s){var a=s!==t-1?s+1:0,c=((i[u].points[s][0]+i[u].points[a][0])/2-i[u].centerPoint[0])*(1+o)+i[u].centerPoint[0],v=((i[u].points[s][1]+i[u].points[a][1])/2-i[u].centerPoint[1])*(1+o)+i[u].centerPoint[1],d=[c,v],g=calculateRegularPolygonsPoints(t,n,l,d);createPolygon(g),r.push(new PreviousPolygon(t,g,n,l,d))}return r}function calculateRegularPolygonsPoints(e,t,n,l){for(var o=360/e,i=[],r=0;e>r;++r){var u=(t+r*o)/180*Math.PI,s=n*Math.cos(u),a=n*Math.sin(u);s+=l[0],a+=l[1],i.push([s,a])}return i}function deleteAllPath(){d3.select("svg#sample").selectAll("path").remove()}function initRangeInput(e,t){d3.selectAll("input#zoom-level")[0][0].value=e,d3.selectAll("input#stroke-width-level")[0][0].value=t,d3.selectAll("#zoom-level-output")[0][0].textContent=e.toFixed(1)+" 倍",d3.selectAll("#stroke-width-level-output")[0][0].textContent=t.toFixed(1)+" px"}function initVerticesRangeInput(e){d3.selectAll("input#vertices")[0][0].value=e,d3.selectAll("#vertices-output")[0][0].textContent="正 "+e+" 角形",d3.select("input#vertices").on("change",function(){d3.selectAll("#vertices-output")[0][0].textContent="正 "+this.value+" 角形"})}function initReducingLevelRangeInput(e){var t=2;d3.selectAll("input#reducing-level")[0][0].value=e,d3.selectAll("#reducing-level-output")[0][0].textContent=e.toFixed(t)+" 倍",d3.select("input#reducing-level").on("change",function(){d3.selectAll("#reducing-level-output")[0][0].textContent=Number(this.value).toFixed(t)+" 倍"})}function setZoomInputListener(e){d3.select("input#zoom-level").on("change",function(){d3.select("svg#sample").selectAll("path").attr({transform:"translate(0, 0) scale("+this.value+")"}),d3.selectAll("#zoom-level-output")[0][0].textContent=Number(this.value).toFixed(1)+" 倍",d3.selectAll("svg#sample").style("width",2*e[0]*this.value+"px").style("height",2*e[1]*this.value+"px")})}function setStrokeWidthInputListener(){d3.select("input#stroke-width-level").on("change",function(){d3.select("svg#sample").selectAll("path").attr({"stroke-width":this.value}),d3.selectAll("#stroke-width-level-output")[0][0].textContent=Number(this.value).toFixed(1)+" px"})}function createPolygon(e){var t=d3.select("svg#sample"),n=d3.svg.line().x(function(t,n){return e[n][0]}).y(function(t,n){return e[n][1]}).interpolate("linear"),l=d3.selectAll("input#zoom-level")[0][0].value,o=d3.selectAll("input#stroke-width-level")[0][0].value,i=60*l,r=t.append("path").attr({d:n(e)+"z",stroke:"#3e3833","stroke-width":o,fill:"none","shape-rendering":"auto",transform:"translate("+i+", "+i+") scale(0.1)","stroke-linejoin":"round"});r.transition().duration(1400).attr({transform:"translate(0, 0) scale("+l+")"})}function calculateNextInnerPoints(e){for(var t=e.length,n=[],l=0;t>l;++l){var o=l+1;l===t-1&&(o=0);var i=(e[l][0]+e[o][0])/2,r=(e[l][1]+e[o][1])/2;n.push([i,r])}return n}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var l=t[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,n,l){return n&&e(t.prototype,n),l&&e(t,l),t}}();window.addEventListener("load",function(){initRangeInput(1,2.5),setStrokeWidthInputListener(),growOuterSquare(5,void 0,.5)},!1);var PreviousPolygon=function(){function e(t,n,l,o,i){_classCallCheck(this,e),this.vertices=t,this.points=n,this.firstAngle=l,this.r=o,this.centerPoint=i}return _createClass(e,null,[{key:"verticesAngle",value:function(e){return 180-360/e}}]),e}();